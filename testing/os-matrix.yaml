# OS/Package Manager Testing Matrix Configuration
# This file defines which package managers should be tested on which operating systems

matrix:
  # Debian-based distributions
  debian-family:
    distributions:
      - ubuntu:22.04
      - debian:12
    package_managers:
      apt:
        available: true
        operations: [search, list, install, remove, upgrade, show]
        test_priority: high
      flatpak:
        available: true
        operations: [search, list, install, remove, show]
        test_priority: medium
        setup_required: true
      snap:
        available: false  # Requires systemd in containers
        operations: []
        test_priority: low
        notes: "Use native CI runners for snap testing"

  # RHEL-based distributions
  rhel-family:
    distributions:
      - rockylinux:9
      - almalinux:9
      - fedora:39
    package_managers:
      dnf:
        available: true
        operations: [search, list, install, remove, upgrade, show]
        test_priority: high
        distributions: ["rockylinux:9", "almalinux:9", "fedora:39"]
      flatpak:
        available: true
        operations: [search, list, show]
        test_priority: low
        setup_required: true

  # Alpine-based
  alpine-family:
    distributions:
      - alpine:3.18
    package_managers:
      apk:
        available: true
        operations: [search, list, install, remove, upgrade, show]
        test_priority: medium

  # SUSE-based
  suse-family:
    distributions:
      - opensuse/leap:15.5
    package_managers:
      zypper:
        available: true
        operations: [search, list, install, remove, upgrade, show]
        test_priority: medium

  # Arch-based (future)
  arch-family:
    distributions:
      - archlinux:latest
    package_managers:
      pacman:
        available: true
        operations: [search, list, install, remove, upgrade, show]
        test_priority: low

# Test execution strategy
test_strategy:
  # Unit tests (parser functions) - run on all OS
  unit:
    scope: all_distributions
    method: docker
    fixture_dependent: true

  # Integration tests (real commands, limited operations)
  integration:
    scope: primary_distributions  # subset for CI efficiency
    method: docker
    operations: [search, list, show, clean, refresh]

  # Full system tests (actual installs/removes)
  system:
    scope: native_runners_only
    method: github_actions_matrix
    operations: [install, remove, upgrade]
    require_privileges: true

# Primary distributions for CI (to limit resource usage)
primary_distributions:
  - ubuntu:22.04       # APT testing
  - fedora:39          # DNF testing
  - alpine:3.18        # APK testing
  - opensuse/leap:15.5 # Zypper testing

# Test fixtures to generate per OS
fixtures:
  apt:
    commands:
      - "apt update && apt search vim"
      - "apt show vim"
      - "apt list --installed | head -20"
      - "apt list --upgradable"

  yum:
    commands:
      - "yum search vim"
      - "yum info vim"
      - "yum list --installed | head -20"

  dnf:
    commands:
      - "dnf search vim"
      - "dnf info vim"
      - "dnf list --installed | head -20"
      - "dnf list --upgrades"

  apk:
    commands:
      - "apk search vim"
      - "apk info vim"
      - "apk list --installed"

  zypper:
    commands:
      - "zypper search vim"
      - "zypper info vim"
      - "zypper list-installed | head -20"
      - "zypper list-updates"
